<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>aweit.fr — Accueil</title>
  <style>
    :root{
      --bg:#0c1020; --panel:#111735; --panel-2:#0f1430; --text:#e8ecff; --muted:#a7b0d6;
      --line:rgba(255,255,255,.08); --accent:#67e8a6; --accent-2:#80a7ff; --warning:#ffcc66;
      --shadow: 0 10px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --sidebar-w: 280px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial;
         background: radial-gradient(1200px 800px at 80% -10%, rgba(127,164,255,.18), transparent),
                     linear-gradient(180deg,#0b0f1a,#0c1020 50%,#0b0f1a);
         color:var(--text);}    
    a{color:var(--accent-2); text-decoration:none}

    /* Top bar (mobile) */
    .topbar{position:sticky; top:0; z-index:50; display:flex; align-items:center; gap:12px;
            padding:12px 14px; background:rgba(12,16,32,.75); backdrop-filter:saturate(140%) blur(8px);
            border-bottom:1px solid var(--line)}
    .brand{font-weight:700; letter-spacing:.3px}
    .hamburger{appearance:none; border:1px solid var(--line); background:var(--panel);
               border-radius:12px; width:42px; height:38px; display:grid; place-items:center; box-shadow:var(--shadow);
               cursor:pointer}
    .hamburger span{width:18px; height:2px; background:#dbe3ff; position:relative; display:block}
    .hamburger span:before,.hamburger span:after{content:""; position:absolute; left:0; width:18px; height:2px; background:#dbe3ff}
    .hamburger span:before{top:-6px} .hamburger span:after{top:6px}

    /* Layout */
    #sidebar{position:fixed; inset:0 auto 0 0; width:var(--sidebar-w); background:linear-gradient(180deg, var(--panel), var(--panel-2));
             border-right:1px solid var(--line); transform:translateX(-100%); transition:transform .28s ease; z-index:60; overflow:auto}
    body.sidebar-open #sidebar{transform:none}
    .overlay{position:fixed; inset:0; background:rgba(0,0,0,.45); opacity:0; visibility:hidden; transition:all .25s ease; z-index:55}
    body.sidebar-open .overlay{opacity:1; visibility:visible}

    @media (min-width: 900px){
      .topbar{display:none}
      #sidebar{transform:none}
      .content{margin-left:var(--sidebar-w)}
      .overlay{display:none}
    }

    /* Sidebar */
    .side-header{display:flex; align-items:center; gap:10px; padding:16px; border-bottom:1px solid var(--line)}
    .dot{width:10px; height:10px; border-radius:999px; background:var(--accent); box-shadow:0 0 10px var(--accent)}
    .logo{font-weight:800; letter-spacing:.35px}
    nav{padding:10px}
    .nav-link{display:flex; align-items:center; gap:10px; padding:12px 14px; border-radius:12px; color:var(--text);
              border:1px solid transparent}
    .nav-link:hover{background:rgba(255,255,255,.05); border-color:var(--line)}
    .nav-link.active{background:rgba(126,165,255,.12); border-color:rgba(126,165,255,.35); color:#dbe7ff}
    .nav-icon{width:18px; height:18px; opacity:.9}

    /* Content */
    .content{min-height:100dvh; padding:18px}
    .container{max-width:1100px; margin:0 auto}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
          border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow)}
    .card .inner{padding:22px}

    .page{display:none; animation: fade .25s ease}
    .page.active{display:block}
    @keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:translateY(0)}}

    .muted{color:var(--muted)}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; font-size:12px; border-radius:999px;
          background:rgba(103,232,166,.12); border:1px solid rgba(103,232,166,.35); color:#d3ffe5}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; border:1px solid var(--line);
         background:rgba(255,255,255,.04); cursor:pointer; color:var(--text)}

    /* Form/Table */
    .form{display:grid; gap:12px}
    @media (min-width: 720px){.form{grid-template-columns: repeat(2,1fr)}}
    .field{display:flex; flex-direction:column; gap:6px}
    .label{font-size:12px; color:var(--muted)}
    .input{appearance:none; background:rgba(255,255,255,.05); border:1px solid var(--line); border-radius:12px; color:var(--text);
           padding:12px 12px; font-size:14px; outline:none}
    .input:focus{border-color:rgba(126,165,255,.5); box-shadow:0 0 0 3px rgba(126,165,255,.18)}
    .input.money{ text-align:right; font-variant-numeric: tabular-nums; letter-spacing:.3px }
    .stat{padding:14px; border:1px solid var(--line); border-radius:14px; background:rgba(255,255,255,.03); margin-top:14px}
    .stat .k{font-size:12px; color:var(--muted); margin-bottom:6px}
    .stat .v{font-size:16px; font-weight:700}
    .danger{color:#ffb4b4}
    .ok{color:#d4ffd4}

    /* Mobile tweaks */
    @media (max-width: 520px){
      table{min-width:540px}
      .input{font-size:16px}
    }
  </style>
</head>
<body>
  <!-- Topbar (mobile) -->
  <div class="topbar">
    <button id="menuToggle" class="hamburger" aria-label="Ouvrir le menu" aria-controls="sidebar" aria-expanded="false"><span></span></button>
    <div class="brand">aweit.fr</div>
  </div>

  <!-- Sidebar -->
  <aside id="sidebar" role="navigation" aria-label="Menu latéral">
    <div class="side-header">
      <div class="dot" aria-hidden="true"></div>
      <div class="logo">Aweit</div>
    </div>
    <nav>
      <div class="nav-section">
        <a href="#accueil" class="nav-link active" data-target="accueil">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 3l9 8h-3v8h-5v-5H11v5H6v-8H3l9-8z"/></svg>
          <span>Accueil</span>
        </a>
        <a href="#star-citizen" class="nav-link" data-target="star-citizen">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2l2.39 4.84L20 8l-3.9 3.8L17.5 18 12 15.6 6.5 18l1.4-6.2L4 8l5.61-1.16L12 2z"/></svg>
          <span>Star Citizen</span>
        </a>
      </div>
    </nav>
  </aside>
  <div class="overlay" id="overlay" hidden></div>

  <!-- Content -->
  <main class="content" id="content" tabindex="-1">
    <div class="container">
      <!-- Page Accueil -->
      <section id="page-accueil" class="page active" aria-labelledby="h-accueil">
        <div class="card"><div class="inner">
          <h1 id="h-accueil" style="margin:0 0 8px 0">Accueil</h1>
          <p class="muted">Bienvenue sur aweit.fr.</p>
        </div></div>
      </section>

      <!-- Page Star Citizen -->
      <section id="page-star-citizen" class="page" aria-labelledby="h-star">
        <div class="card"><div class="inner">
          <div class="pill">Outil</div>
          <h1 id="h-star" style="margin:10px 0 8px 0">Répartition des bénéfices — Star Citizen</h1>

          <div class="form" role="form">
            <div class="field">
              <label class="label" for="totalSale">Vente totale (aUEC)</label>
              <input id="totalSale" class="input money" type="text" inputmode="decimal" placeholder="ex. 1 250 000">
            </div>
            <div class="field">
              <label class="label" for="sendRate">Frais d’envoi (%) — identiques pour tous (défaut 0,5)</label>
              <input id="sendRate" class="input" type="number" inputmode="decimal" min="0" step="0.01" value="0.5" />
            </div>
          </div>

          <div class="card" style="margin-top:14px"><div class="inner" style="padding:0">
            <div style="overflow:auto">
              <table style="width:100%; border-collapse:separate; border-spacing:0; min-width:640px" aria-label="Tableau des joueurs">
                <thead>
                  <tr style="text-align:left; font-size:12px; color:var(--muted)">
                    <th style="padding:12px 14px; border-bottom:1px solid var(--line)">Joueur</th>
                    <th style="padding:12px 14px; border-bottom:1px solid var(--line)">Investi (aUEC)</th>
                    <th style="padding:12px 14px; border-bottom:1px solid var(--line)">% part</th>
                    <th style="padding:12px 14px; border-bottom:1px solid var(--line)">Part bénéfice (aUEC)</th>
                    <th style="padding:12px 14px; border-bottom:1px solid var(--line)">Net à recevoir</th>
                    <th style="padding:12px 14px; border-bottom:1px solid var(--line)"></th>
                  </tr>
                </thead>
                <tbody id="playersBody"></tbody>
              </table>
            </div>
          </div></div>

          <div style="display:flex; gap:10px; margin-top:14px; flex-wrap:wrap">
            <button class="btn" id="addPlayer">Ajouter un joueur</button>
            <button class="btn" id="resetShare">Réinitialiser</button>
          </div>

          <!-- Synthèse en bas -->
          <div class="stat" id="summary" style="margin-top:14px">
            <div class="k">Synthèse</div>
            <div class="v" style="font-weight:500">
              <span id="sumPlayers">Investi joueurs : –</span> · 
              <span id="sumSale">Vente totale : –</span>
              <br/>
              <span id="distributable">Bénéfice répartissable : –</span> · 
              <span id="sendFeesTotal">Frais d’envoi totaux : –</span> · 
              <span id="afterSendFees">Net après envois : –</span>
            </div>
          </div>

        </div></div>
      </section>
    </div>
  </main>

  <script>
    // =====================
    // Navigation responsive
    // =====================
    const body = document.body;
    const toggle = document.getElementById('menuToggle');
    const overlay = document.getElementById('overlay');
    const links = Array.from(document.querySelectorAll('.nav-link[data-target]'));

    function openSidebar(){ body.classList.add('sidebar-open'); toggle?.setAttribute('aria-expanded','true'); overlay.hidden = false; }
    function closeSidebar(){ body.classList.remove('sidebar-open'); toggle?.setAttribute('aria-expanded','false'); overlay.hidden = true; }

    toggle?.addEventListener('click', () => {
      if(body.classList.contains('sidebar-open')) closeSidebar(); else openSidebar();
    });
    overlay?.addEventListener('click', closeSidebar);

    function showPage(key){
      links.forEach(a=>a.classList.toggle('active', a.dataset.target===key));
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      const page = document.getElementById('page-'+key);
      if(page){ page.classList.add('active'); page.focus?.(); }
      closeSidebar();
    }

    links.forEach(a=> a.added || (a.added = a.addEventListener('click', (e)=>{
      e.preventDefault();
      const key = a.dataset.target;
      history.replaceState({}, '', '#'+key);
      showPage(key);
    })));

    const initial = (location.hash||'#accueil').replace('#','');
    showPage(initial);

    // ============================================
    // Répartition des bénéfices — logique
    // ============================================
    function parseNum(v){ if(v==null) return 0; const t = (''+v).replace(/[^0-9.,-]/g,'').replace(',', '.'); const f = parseFloat(t); return Number.isFinite(f) ? f : 0; }

    // French grouping with regular spaces (1 234 567,89)
    const nf = new Intl.NumberFormat('fr-FR', { maximumFractionDigits: 2 });
    const f = (n)=> nf.format(n).replace(/\u00A0|\u202F/g, ' ');

    const totalSaleInput = document.getElementById('totalSale');
    const sendRateInput = document.getElementById('sendRate');

    const playersBody = document.getElementById('playersBody');
    const sumPlayersEl = document.getElementById('sumPlayers');
    const sumSaleEl = document.getElementById('sumSale');
    const distributableEl = document.getElementById('distributable');
    const sendFeesTotalEl = document.getElementById('sendFeesTotal');
    const afterSendFeesEl = document.getElementById('afterSendFees');

    let players = [];

    function save(){
      localStorage.setItem('sc_share_calc_v2', JSON.stringify({
        totalSale: totalSaleInput.value,
        sendRate: sendRateInput.value,
        players
      }));
    }

    // Pure computation for tests & UI
    function computeSharesPure(players, totalSale, rate){
      const totalInvest = players.reduce((s,p)=> s + Math.max(0, parseNum(p.invest)), 0);
      const distributable = totalSale - totalInvest;
      const parts = [];
      const fees = [];
      const nets = [];
      let totalFees = 0;
      players.forEach(p=>{
        const invest = Math.max(0, parseNum(p.invest));
        const share = totalInvest>0 ? invest/totalInvest : 0;
        const part = share * distributable;
        const fee = part * (Math.max(0, rate)/100);
        const net = part - fee;
        parts.push(part); fees.push(fee); nets.push(net); totalFees += fee;
      });
      const afterFees = distributable - totalFees;
      return { totalInvest, distributable, parts, fees, nets, totalFees, afterFees };
    }

    // Pretty-print inputs with spaces on blur
    function prettify(el){
      const raw = (el.value||'').trim();
      if(raw==='') return; // keep empty
      const num = parseNum(raw);
      if(Number.isFinite(num)) el.value = nf.format(num).replace(/\u00A0|\u202F/g, ' ');
    }

    function row(player, idx){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="padding:10px 14px; border-bottom:1px solid var(--line)">
          <input class="input" style="width:180px" placeholder="Pseudo" value="${player.name||''}">
        </td>
        <td style="padding:10px 14px; border-bottom:1px solid var(--line)">
          <input class="input money" type="text" inputmode="decimal" style="max-width:160px" placeholder="0" value="${player.invest||''}">
        </td>
        <td style="padding:10px 14px; border-bottom:1px solid var(--line)"><span class="muted partPct">–</span></td>
        <td style="padding:10px 14px; border-bottom:1px solid var(--line)"><span class="partAmt">–</span></td>
        <td style="padding:10px 14px; border-bottom:1px solid var(--line)"><span class="netAmt">–</span></td>
        <td style="padding:10px 14px; border-bottom:1px solid var(--line)"><button class="btn remove">×</button></td>
      `;

      const nameI = tr.querySelector('input[placeholder="Pseudo"]');
      const investI = tr.querySelectorAll('input')[1];
      const pctS = tr.querySelector('.partPct');
      const partS = tr.querySelector('.partAmt');
      const netS = tr.querySelector('.netAmt');
      const removeB = tr.querySelector('.remove');

      nameI.addEventListener('input', ()=>{ players[idx].name = nameI.value; compute(); });
      investI.addEventListener('input', ()=>{ players[idx].invest = investI.value; compute(); });
      investI.addEventListener('blur', ()=> prettify(investI));
      removeB.addEventListener('click', ()=>{ players.splice(idx,1); render(); compute(); });

      if(investI.value) prettify(investI);

      tr._refs = { pctS, partS, netS, investI };
      return tr;
    }

    function render(){
      playersBody.innerHTML = '';
      players.forEach((p, i)=> playersBody.appendChild(row(p, i)));
    }

    function compute(){
      const totalSale = parseNum(totalSaleInput.value);
      const rate = Math.max(0, parseNum(sendRateInput.value));

      const { totalInvest, distributable, parts, nets, totalFees, afterFees } = computeSharesPure(players, totalSale, rate);

      sumPlayersEl.textContent = `Investi joueurs : ${f(totalInvest)} aUEC`;
      sumSaleEl.textContent = `Vente totale : ${totalSale>0?f(totalSale)+' aUEC':'—'}`;
      distributableEl.textContent = `Bénéfice répartissable : ${Number.isFinite(distributable)?f(distributable)+' aUEC':'—'}`;

      players.forEach((p, i)=>{
        const invest = Math.max(0, parseNum(p.invest));
        const share = (totalInvest>0 ? invest/totalInvest : 0);
        const part = parts[i] ?? 0;
        const net = nets[i] ?? 0;
        const rowEl = playersBody.children[i];
        if(!rowEl || !rowEl._refs) return;
        rowEl._refs.pctS.textContent = share>0 ? f(share*100)+' %' : '–';
        rowEl._refs.partS.textContent = Number.isFinite(part) ? f(part)+' aUEC' : '–';
        rowEl._refs.netS.textContent = Number.isFinite(net) ? f(net)+' aUEC' : '–';
        rowEl._refs.netS.className = 'netAmt ' + (net>=0 ? 'ok':'danger');
      });

      sendFeesTotalEl.textContent = `Frais d’envoi totaux : ${f(totalFees)} aUEC`;
      afterSendFeesEl.textContent = `Net après envois : ${f(afterFees)} aUEC`;

      save();
    }

    document.getElementById('addPlayer')?.addEventListener('click', ()=>{ players.push({name:'', invest:''}); render(); compute(); });

    document.getElementById('resetShare')?.addEventListener('click', ()=>{
      players = [];
      [totalSaleInput,sendRateInput].forEach(i=> i.value='');
      sendRateInput.value = '0.5';
      render(); compute(); localStorage.removeItem('sc_share_calc_v2');
    });

    [totalSaleInput,sendRateInput].forEach(i=> i?.addEventListener('input', compute));
    totalSaleInput.addEventListener('blur', ()=> prettify(totalSaleInput));

    // restore
    try{
      const saved = JSON.parse(localStorage.getItem('sc_share_calc_v2')||'null');
      if(saved){
        totalSaleInput.value = saved.totalSale||'';
        sendRateInput.value = saved.sendRate||'0.5';
        players = Array.isArray(saved.players) ? saved.players : [];
      }
    }catch{}

    render();
    if(totalSaleInput.value) prettify(totalSaleInput);
    compute();

    // =====================
    // Tests (console only)
    // =====================
    function approx(a,b,eps=0.01){ return Math.abs(a-b) <= eps; }
    function runSCShareTests(){
      const out = [];
      const log = (ok,msg)=> out.push(`${ok? '✅':'❌'} ${msg}`);
      // Test A: 1.25M sale, invests 400k/300k/300k, rate 0.5%
      { const players=[{invest:400000},{invest:300000},{invest:300000}];
        const r = computeSharesPure(players, 1250000, 0.5);
        log(approx(r.totalInvest,1000000),'A totalInvest=1,000,000');
        log(approx(r.distributable,250000),'A distributable=250,000');
        log(approx(r.parts[0],100000)&&approx(r.parts[1],75000)&&approx(r.parts[2],75000),'A parts=100k/75k/75k');
        log(approx(r.totalFees,1250),'A total fees=1,250');
        log(approx(r.afterFees,248750),'A after fees=248,750'); }
      // Test B: no players
      { const r = computeSharesPure([], 500000, 1);
        log(approx(r.totalInvest,0),'B totalInvest=0');
        log(approx(r.distributable,500000),'B distributable=500,000');
        log(r.parts.length===0 && r.nets.length===0,'B arrays empty');
        log(approx(r.totalFees,0),'B totalFees=0'); }
      // Test C: 0% rate
      { const r = computeSharesPure([{invest:200},{invest:300}], 1000, 0);
        log(approx(r.totalFees,0),'C totalFees=0');
        log(approx(r.nets[0]+r.nets[1], r.distributable),'C nets sum to distributable'); }
      console.log(out.join('\n'));
      return out;
    }
    window.runSCShareTests = runSCShareTests;
  </script>
</body>
</html>
